<!--
--- UCSF Chimera Copyright ---
Copyright (c) 2011-2015 Regents of the University of California.
All rights reserved.  This software provided pursuant to a
license agreement containing restrictions on its disclosure,
duplication and use.  This notice must be embedded in or
attached to all copies, including partial copies, of the
software or any revisions or derivations thereof.
--- UCSF Chimera Copyright ---
-->

<html>
<head>
<TITLE>Animation</TITLE>
</head>
<body>
<h3>Animation <img src="animicon.png" alt="Animation icon"></h3>
<p>
The <b>Animation</b> tool allows saving and restoring
<a href="#scenes">scenes</a> in Chimera, placing scenes along a 
<a href="#keyframes">timeline</a>, and 
<a href="#recording">recording</a> a movie of the resulting animation.
See also:
<a href="../recorder/recorder.html"><b>Movie Recorder</b></a>,
<a href="../demos/demos.html"><b>Demos</b></a>,
<a href="../../UsersGuide/rapid.html"><b>Rapid Access</b></a>,
<a href="../../UsersGuide/sessions.html">Chimera sessions</a>,
<a href="../../UsersGuide/movies.html">making movies</a>
</p><p>
**&nbsp;Not all aspects of Chimera are included in <a href="#scenes">scenes</a> 
and/or handled correctly in <b>Animation</b> transitions
(see <a href="#limitations">limitations</a>).&nbsp;**
</p><p>
There are <a href="../../UsersGuide/extension.html">several ways to start</a>
<b>Animation</b>, a tool in the <b>Utilities</b> category.
Clicking <b>Preferences</b> opens the
<a href="../../UsersGuide/preferences.html#Animation"><b>Animation</b>
preferences</a>.
<b>Close</b> dismisses the <b>Animation</b> dialog, and
<b>Help</b> opens this manual page in a browser window.
</p>

<a name="scenes">
<h3>Scenes</h3></a>
<p>
A Chimera <b><i>scene</i></b> includes:
</p>
<ul>
<li>locations and orientations of models and clipping planes
(<i>etc.</i>, as in a saved 
<a href="../../UsersGuide/midas/savepos.html">position</a>)
<li>display styles, colors, and visibilities of molecule models, 
molecular surfaces, and their parts
<li><a href="../volumeviewer/framevolumeviewer.html" target="_top">volume</a>
displays
<li><a href="../structuremeas/structuremeas.html#axes">axis, plane, 
and centroid</a> representations
<li>3D labels, <a href="../2dlabels/2dlabels.html">2D labels</a>,
<a href="../2dlabels/2dlabels.html#colorkey">color keys</a>
<li><a href="../../UsersGuide/castp.html">CASTp</a> pocket display
<li>certain global parameters such as
<a href="../../UsersGuide/chimerawindow.html#bg_color">background</a>,
<a href="../../UsersGuide/sideview.html#lighting">lighting</a>, and
<a href="../../UsersGuide/sideview.html#effects">effects</a>
</ul>
<p>
Scenes do not include all aspects of Chimera.
Scenes increase <a href="../../UsersGuide/sessions.html">session</a>
file size.
</p><p>
Clicking the plus icon <img src="anim-add.png" width="18"> in the 
<b>Scenes</b> section of the the <a href="frameanimation.html"
target="_top"><b>Animation</b></a> dialog
saves the current state of Chimera as a scene and generates a thumbnail image
to represent it.  Clicking the thumbnail restores the corresponding scene.
Scenes can also be saved and restored with 
the <a href="../../UsersGuide/midas/scene.html"><b>scene</b></a> command, or 
restored from <a href="../../UsersGuide/rapid.html"><b>Rapid Access</b></a>.
</p><p>
<a name="scene-context"></a>
Right-clicking a scene thumbnail raises a context menu with the options:
</p>
<ul>
<li><b>Add to timeline</b> 
- append the scene to the <a href="#keyframes">timeline</a>
<li><b>Properties</b> - open a dialog for editing the scene name and description
<li><b>Update</b> - overwrite the scene with the current state of Chimera
<li><b>Delete</b> - delete the scene<sup><a href="#note">*</a></sup>
</ul>
<a name="note">*</a>
Deleting a scene also removes its occurrences 
from the <a href="#keyframes">timeline</a>.
</p><p>
<a name="chosen-scene">
Clicking a scene thumbnail not only restores the scene in Chimera
but also chooses the scene (highlights the thumbnail) in the dialog.
</a>
Multiple scenes in a contiguous block can be chosen by 
clicking the first (or last) thumbnail in the block
and then <b>Shift</b>-clicking on the last (or first) thumbnail.
<b>Ctrl</b>-click toggles the state of a single scene.
The chosen scene(s) can be collectively: 
<ul>
<li>deleted<sup><a href="#note">*</a></sup> by clicking the minus icon 
<img src="anim-remove-red.png" width="18">
in the <b>Scenes</b> section of the dialog
<li>appended to the <a href="#keyframes">timeline</a> by clicking the plus icon
<img src="anim-add.png" width="18"> in the <b>Timeline</b> section of the dialog
</ul>

<a name="keyframes">
<h3>Keyframes, Actions, and Timeline</h3></a>
<p>
A <b><i>keyframe</i></b> is simply a <a href="#scenes">scene</a>
in the context of a <b><i>timeline</i></b>.
Each keyframe is associated with a preceding <b><i>transition</i></b> 
of one or more display frames.
The timeline may also contain <b><i>actions</i></b>, or
operations in Chimera other than transitions between keyframes.
</p><p>
<a name="actions">
Available <b>Actions</b>:
</a>
<ul>
<li><b>Rock</b> - oscillating rotation
<li><b>Roll</b> - continuous rotation
</ul>
</p><p>
In <a href="frameanimation.html" target="_top"><b>Animation</b></a>,
a <a href="#scenes">scene</a> or an <a href="#actions">action</a> 
can be inserted into the <b>Timeline</b> by drag-and-drop,
or a scene can be appended with <b>Add to timeline</b> in its 
<a href="#scene-context">right-click menu</a>.
One or more <a href="#chosen-scene">chosen scenes</a>
(or similarly, an action chosen by clicking its thumbnail)
can be appended to the timeline by clicking 
the plus icon <img src="anim-add.png" width="18"> above the timeline.
</p><p>
Keyframes and actions can be repositioned along the timeline by: 
<ul>
<li>dragging, where Shift-dragging also moves any 
subsequent (rightward) keyframes and actions in parallel
<li>editing <a href="#kf-context">duration</a>, which will also
move any subsequent (rightward) keyframes and actions in parallel
</ul>
Giving the first (leftmost) keyframe a duration &gt; 0 frames
indicates repeating its contents accordingly,
since there is no preceding keyframe 
to define a transition; this is indicated with a gray rectangle 
extending from the start of the timeline to the keyframe position.
</p><p>
The timeline contents can be <a href="#playback">played back</a> to
preview the movie that would result from <a href="#recording">recording</a>.
</p><p>
<a name="kf-context"></a>
Right-clicking a keyframe or action thumbnail
raises a context menu with the options:
</p>
<ul>
<li><b>Properties</b> - edit <a href="#properties">properties</a> 
of the action, or for a keyframe, the preceding transition
<li><b>Delete</b> - remove the keyframe or action from the timeline
</ul>
<a name="properties">
Keyframe/action properties</a>:
<ul>
<li><b>Duration</b>
  <ul>
  <li><b>Duration in frames</b> - number of frames; if changed, all 
  subsequent (rightward) keyframes and actions will shift accordingly
  <li><b>Nth frame for discrete transitions</b> 
  - frame at which discontinuous changes should occur
<p>
Properties that change continuously include: model orientations and scale;
<a href="../../UsersGuide/clipping.html">clipping plane</a> positions;
colors and display states (faded in/out with transparency) of atoms, ribbons, 
and <a href="../../UsersGuide/representation.html#surfaces">molecular 
surfaces</a>; colors, display states, and
positions of <a href="../2dlabels/2dlabels.html">2D labels</a>.
Discontinuous changes include those in
<a href="../../UsersGuide/representation.html">atom/bond styles</a>
and <a href="../volumeviewer/framevolumeviewer.html" target="_top">volume 
displays</a>.
Transitions between different frames of a
<a href="../movie/framemovie.html" target="_top">trajectory</a>
will linearly interpolate the trajectory frame number but use only
integer values, thus duplicating or skipping trajectory frames
as needed to produce the specified duration.
</p>
 </ul>
<li><b>Parameters</b> - action-specific settings
  <ul>
  <li>for <b>Rock</b>:
    <ul>
    <li><b>Angle to rock through</b> (default <b>60</b>&deg;)
    <li><b>Axis of rotation</b> (x/<b>y</b>/z)
    <li><b>Times to rock</b> (default <b>1</b>)
    </ul>
  <li>for <b>Roll</b>:
     <ul>
     <li><b>Degrees to rotate</b> (default <b>360</b>&deg;)
     <li><b>Axis of rotation</b> (x/<b>y</b>/z)
     <li><b>Precess around axis</b> (true/<b>false</b>)
      - whether to also rotate around a moving axis
      that is carried along by the main rotation (see the 
    <a href="https://www.rbvi.ucsf.edu/chimera/animations/animations.html#wobble"
    target="_blank"><b>Wobble motion</b></a> movie in the
      Chimera Animation Gallery</a>)
     <li><b>Precession tilt</b> (default <b>10</b>&deg;)
      - the angle between the moving axis and the main axis of rotation
     </ul>
  </ul>
</ul>
</p><p>
<a name="chosen-kf">
Clicking a thumbnail in the timeline chooses the keyframe or action
(highlights the thumbnail).
</a>
Multiple keyframes/actions in a contiguous block can be chosen by 
clicking the first (or last) thumbnail in the block
and then <b>Shift</b>-clicking on the last (or first) thumbnail.
<b>Ctrl</b>-click toggles the state of a single keyframe or action.
The chosen keyframes/actions can be collectively: 
<ul>
<li>removed from the timeline by clicking the minus icon 
<img src="anim-remove-red.png" width="18">
in the <b>Timeline</b> section of the dialog
<li>dragged in parallel along the timeline
</ul>
Timeline display can be:
<ul>
<li>expanded by clicking the zoom-in icon <img src="zoom-in.png" width="18">
<li>subsequently restored to the original size by clicking the zoom-out icon
<img src="zoom-out.png" width="18">
</ul>
</p>

<a name="playback">
<h3>Playback</h3></a>
<p>
In <a href="frameanimation.html" target="_top"><b>Animation</b></a>,
<a name="scrubdef">
a red vertical line (the <b><i>scrubber</i></b>) 
indicates playback position on the <a href="#keyframes">timeline</a>.
</a>
Double-clicking a keyframe thumbnail moves the scrubber to that keyframe
and restores the corresponding scene in Chimera. Other playback features
are provided by clickable icons:
</p>
<table border cellpadding="4" cellspacing="0" width="80%">
<tr>
<td align="center"><b>icon</b></td><td><b>meaning</b></td>
</tr><tr>
<td align="center"><img src="anim-play.png"></td>
<td>play animation; switches to a pause icon 
<img src="anim-pause.png" width="22">
during playback, and if playback is paused, to a resume-play icon
<img src="anim-play-pause.png" width="22">
</td>
</tr><tr>
<td align="center"><img src="anim-plusOne-on.png"></td>
<td>advance playback by a single display frame</td>
</tr><tr>
<td align="center"><img src="anim-loop-off.png"></td>
<td>toggle looping during playback (brighter icon when on)</td>
</tr></table>
<p>
During playback, the target display rate is set to 25 frames per second,
to match as closely as possible the speed of the movie 
that would result from <a href="#recording">recording</a> with default
encoding options
(<a href="../../UsersGuide/movies.html#speed">details...</a>).
</p>

<a name="recording">
<h3>Recording</h3></a>
<p>
Clicking the recording icon <img src="anim-record-off.png" width="18">
in the <a href="frameanimation.html" target="_top"><b>Animation</b></a> dialog
opens a dialog with movie settings. After the necessary inputs have been 
specified, clicking <b>Record</b> initiates playing and recording the animation
(as defined in the <a href="#keyframes">timeline</a>) from start to finish.
Recording in progress is indicated by a brighter icon,
which can be clicked to abort the process; otherwise, the resulting
series of images will be encoded into a movie file.
Settings:
<ul>
<li><b>File name</b> - name for the resulting movie file
<li><b>File type</b> (movie format) choices:
  <ul>
  <li>H.264 [.mp4]
  <li>VP8/WebM [.webm]
  <li>Theora [.ogv]
  <li>Quicktime [.mov]
  <li>AVI MSMPEG-4v2 [.avi]
  <li>MPEG-4 [.mp4]
  <li>MPEG-2 [.mpg]
  <li>MPEG-1 [.mpg]
  <li>WMV2 [.wmv]
  <li>APNG [.png] - animated PNG
(lossless, settings for <a href="#advanced"><b>quality</b></a> and
<a href="../../UsersGuide/midas/movie.html#bitrate"><b>bitrate</b></a> 
do not apply)
  </ul>
  <li><b>Rendering</b>:
    <ul>
    <li><b>Chimera</b> (default)
   - Chimera rendering, normally offscreen
   (<a href="../../UsersGuide/print.html#exception">details...</a>).
   Images can be supersampled, that is, initially generated at a
   higher resolution and then sampled down to the final size.
      <ul>
      <li><b>Supersample</b> (1x1/2x2/<b>3x3</b>/4x4)
      - how many pixels to sample in the X and Y dimensions for each pixel in
      the final saved image; thus, 1x1 corresponds to no supersampling.
      Higher values increase the smoothness of edges in saved images and
      increase calculation time with little effect on file size.
      3x3 is generally recommended when supersampling is done.
      </ul>
    <li><a name="raytrace"><b>POV-Ray</b></a>
  - <a href="../../UsersGuide/raytracing.html">raytrace with POV-Ray</a>.
  This rendering option is the slowest but includes fancier effects
  such as high-quality shadows.
  The <b>POV-Ray Options</b> button opens the corresponding
  <a href="../../UsersGuide/preferences.html#POV-Ray Options">preferences</a>.
    </ul>
</ul>
<a name="advanced"></a>
<b>Advanced Options</b>:
<ul>
  <li><b>Quality</b> (highest/higher/high/<b>good</b>/medium/fair/low)
- higher quality corresponds to higher (variable) playback bit rates and
  a larger movie file, assuming the same window size and movie frame rate
  <li><b>Image format</b> - image file format
(however, PNG will be used regardless of this setting if
<a href="#raytrace">raytracing</a> is done):
    <ul>
    <li>JPEG [.jpeg]
    <li>PNG [.jpeg]
    <li>PPM [.jpeg] (default)
    </ul>
<li><b>Additional recording options</b>
- options are the same as for the command
<a href="../../UsersGuide/midas/movie.html#record-options"><b>movie
record</b></a>; if this field is left blank, image frames will be saved
with default names in a default location
(but normally deleted after movie encoding, depending on the encoding options)
<li><b><a name="encoding">Additional encoding options</a></b>
- options are the same as for the command
<a href="../../UsersGuide/midas/movie.html#encode-options"><b>movie
encode</b></a>; if this field is left blank,
the movie will be encoded to play at 25 frames per second,
and image frames will be deleted after the movie has been encoded
</ul>
<b>Close</b> closes the dialog without initiating recording.
<b>Image Tips</b> shows the <a href="../../UsersGuide/print.html#tips">tips
on preparing images</a>, and
<b>Help</b> opens this manual page in a browser window.
</p>

<table border cellpadding="0" cellspacing="0"
align="right" style="margin:8px 8px 8px 8px">
<tr><td><a href="storyboard-example.png">
<img src="storyboard-example.png" width="240" title="click for larger..." 
alt="storyboard in browser window"></a></td></tr>
</table>

<a name="storyboard">
<h3>Animation Storyboard</h3></a>
<p>
Clicking the storyboard icon <img src="storyboard.png" width="18">
in <a href="frameanimation.html" target="_top"><b>Animation</b></a>
opens a dialog for specifying a directory in which to save storyboard files.
The files include <b>index.html</b>, 
with HTML title as specified in the save dialog,
and three files for each <a href="#scenes">scene</a> in the 
<a href="#keyframes">timeline</a>:
<ul>
<li><b><i>scene_name</i>.html</b> - <a href="../../UsersGuide/export.html">WebGL
export</a>
<li><b><i>scene_name</i>.png</b> - full-sized image
<li><b><i>scene_name</i>_tn.png</b> - thumbnail image
</ul>
The storyboard can be viewed by opening <b>index.html</b> (which embeds the
remaining files) in a browser window.  A small example is shown at right.
</p><p>
Across the top are thumbnails of the keyframes 
in the order in which they appear in the timeline, with consecutive
keyframes that are the same scene collapsed into a single entry.
The central panel shows either the static image or the 3D-manipulable 
<a href="https://www.khronos.org/webgl/" target="_blank">WebGL</a>
rendering of a scene. Clicking a thumbnail or navigating the series
of thumbnails with the keyboard left and right arrows updates the central
panel to the static image of the corresponding scene.
Pressing the <b>l</b> (letter ell)
key or clicking <b>Load 3D Data</b> loads the corresponding WebGL data into
the central panel.  When WebGL is shown, the corresponding static image can
be obtained again by clicking <b>Load Image</b>,
or by clicking in the browser window outside of the central panel 
and then pressing the <b>i</b> key.
</p>

<a name="limitations">
<h3>Limitations</h3></a>
<p>
Several problems with <a href="#scenes">scenes</a> and/or <b>Animation</b>
have been reported, including those related to:
<ul>
<li>gradually fading out surfaces
<!-- #14266 -->
<li>trajectory playback with molecular surfaces
<!-- #14278 -->
<li>molecular surface if atoms added or deleted
<!-- #14134 -->
<li>hiding/showing
<a href="../pipesandplanks/pipesandplanks.html"><b>PipesAndPlanks</b></a> 
representations
<li><a href="../colorzone/colorzone.html"><b>Color Zone</b></a>
<!-- #14198 -->
<li>saving symmetry copies 
(<i>e.g.</i> from <a href="../../UsersGuide/midas/sym.html"><b>sym</b></a>)
in a scene
<!-- #14281 -->
<li>saving <a href="../volumepathtracer/framevolpath.html" target="_top">markers</a>
in a scene
<!-- #14194 -->
<li>saving a <a href="../../UsersGuide/sessions.html">session</a>
with a molecular surface in a scene
<!-- #14287 -->
</ul>
</p>

<hr>
<address>UCSF Computer Graphics Laboratory / December 2021</address>
</body>
</html>
