<!--
--- UCSF Chimera Copyright ---
Copyright (c) 2000-2016 Regents of the University of California.
All rights reserved.  This software provided pursuant to a
license agreement containing restrictions on its disclosure,
duplication and use.  This notice must be embedded in or
attached to all copies, including partial copies, of the
software or any revisions or derivations thereof.
--- UCSF Chimera Copyright ---
-->

<html>
<head>
<TITLE>MD Movie</TITLE>
</head>
<body>
<a name="top"></a>
<h3>MD Movie <img src="movie.png" alt="MD Movie icon"></h3>

<p>
<b>MD Movie</b> is a tool for viewing and analysis of trajectories
and other ensembles.
For examples of use, see the
<a href="../../UsersGuide/tutorials/ensembles2.html">Trajectory and 
Ensemble Analysis tutorial</a>.  See also:
<a href="../morph/morph.html"><b>Morph Conformations</b></a>,
<a href="../md/md.html"><b>Molecular Dynamics Simulation</b></a>,
<a href="../../UsersGuide/midas/coordset.html"><b>coordset</b></a>
</p><p>
There are <a href="../../UsersGuide/extension.html">several ways to start</a>
<b>MD Movie</b>, a tool in the <b>MD/Ensemble Analysis</b> category.
</p><p>
<a name="movieinput">
Several formats are supported</a>:
</p>
<table border cellspacing="0" cellpadding="4" style="margin:8px 8px 8px 8px">
<tr><th align="center">Format</th>
<th align="center">Required Inputs</th></tr>
<tr><td align="center"><a href="https://ambermd.org/" 
target="_blank"><b>Amber</b></a></td>
<td>
<ul>
<li>prmtop (parameter/topology) file, either the
<a href="https://ambermd.org/formats.html#topology" target="_blank">
older</a> or the newer format (see Appendix E of the
<a href="https://ambermd.org/doc7/amber7.pdf" target="_blank">Amber 7 Manual</a>)
<li>trajectory (coordinates), either
<a href="https://ambermd.org/FileFormats.php#trajectory" target="_blank">
formatted</a> or 
<a href="https://ambermd.org/netcdf/nctraj.xhtml" target="_blank">
Amber NetCDF</a>, which is binary.  
Multiple trajectory files can be specified, 
to be concatenated in the order given.  Additional trajectory files 
can be <a href="#loadmore">loaded</a> at a later stage.
</ul>
Amber residue names are remapped to standard PDB residue names where possible. 
Partial charges are assigned as the atom 
<a href="../defineattrib/defineattrib.html#attribdef">attribute</a> 
named <b>charge</b>.
Amber NetCDF support is courtesy of Mingfeng Yang.
</td></tr>
<tr><td align="center">
<a href="http://yuri.harvard.edu/index.html" target="_blank"><b>CHARMM</b></a>,
<a href="https://www.ks.uiuc.edu/Research/namd/index.html"
target="_blank"><b>NAMD</b></a> <b>(PSF/DCD)</b>, or 
<a href="https://en.wikipedia.org/wiki/X-PLOR"
target="_blank"><b>X-PLOR</b></a></td>
<td>
<ul>
<li>PSF (protein structure file; X-PLOR-style topology)
<li>DCD (binary trajectory). Multiple DCD files can be specified,
to be concatenated in the order given.	Additional DCD files
can be <a href="#loadmore">loaded</a> at a later stage.
</ul>
Partial charges are assigned as the atom 
<a href="../defineattrib/defineattrib.html#attribdef">attribute</a> 
named <b>charge</b>, and segment names as the residue 
<a href="../defineattrib/defineattrib.html#attribdef">attribute</a> 
named <b>segment</b>.
PSF/DCD support is courtesy of 
<a href="https://www.ks.uiuc.edu/~jim/mdtools/index.html"
target="_blank">MDTools</a>.
</td></tr>
<tr><td align="center">
<a href="https://www.ks.uiuc.edu/Research/namd/index.html"
target="_blank"><b>NAMD</b></a> <b>(prmtop/DCD)</b>
<td>
<ul>
<li>prmtop (AMBER-style parameter/topology file)
<li>DCD (binary trajectory). Multiple DCD files can be specified,
to be concatenated in the order given.	Additional DCD files
can be <a href="#loadmore">loaded</a> at a later stage.
</ul>
Partial charges are assigned as the atom 
<a href="../defineattrib/defineattrib.html#attribdef">attribute</a> 
named <b>charge</b>.  DCD support is courtesy of 
<a href="https://www.ks.uiuc.edu/~jim/mdtools/index.html"
target="_blank">MDTools</a>.
</td></tr>
<tr><td align="center">
<a href="http://www.gromacs.org/" target="_blank">
<b>GROMACS</b></a></td>
<td>
<ul>
<li>portable binary <a href="http://manual.gromacs.org/documentation/5.1/user-guide/file-formats.html"
target="_blank">run input file</a> (.tpr)
<li>portable <a href="http://manual.gromacs.org/documentation/5.1/user-guide/file-formats.html"
target="_blank">trajectory file</a>,
binary (.trr) or compressed (.xtc) 
</ul>
XTC/TRR support is courtesy of the
<a href="http://manual.gromacs.org/documentation/5.1/user-guide/file-formats.html#using-xtc-in-your-c-programs"
target="_blank">XTC Library</a>.
</td></tr>
<tr><td align="center">
<a href="http://gromos.net" target="_blank">
<b>GROMOS</b></a></td>
<td>
<ul>
<li>topology
<li>coordinates (trajectory)
<li>PROMD (PROMD input file used to generate the trajectory)
<li>a scale factor to convert the coordinates to angstroms (usually 10.0)
</ul>
</td></tr>
<tr><td align="center">
<a href="http://dirac.cnrs-orleans.fr/MMTK/" target="_blank"><b>MMTK</b></a>
</td>
<td><ul>
<li><a href="https://www.unidata.ucar.edu/software/netcdf/"
target="_blank">NetCDF</a> trajectory
</ul>
</td></tr>
<tr><td align="center">
<a href="particle.html"><b>particle</b></a>
</td><td>
<ul>
<li>particle trajectory based on
<a href="https://ambermd.org/netcdf/nctraj.xhtml" target="_blank">Amber 
NetCDF</a> (<a href="particle.html">details</a>)
</ul>
</td></tr>
<tr><td align="center">
<b>PDB</b>, <b>single file</b> 
<br>(coordinates for each frame bracketed 
by MODEL and ENDMDL records)</td>
<td>The name of the file must be supplied.
The MODEL numbers are interpreted as frame numbers 
and should start with 1 or 0 and increment by 1.
</td></tr>
<tr><td align="center">
<b>PDB</b>, <b>multiple files</b> 
<br>(one file per frame)</td>
<td>Starting and ending file names must be supplied.  
The file names must include frame numbers, and the frames
will be ordered by increasing number 
(not necessarily consecutive; missing numbers will be ignored).
The files must not contain END records.
</td></tr>
<tr><td align="center">
<a href="../../UsersGuide/xyz.html"><b>XYZ</b></a>
<br>(multiple files, one per frame)</td>
<td>Starting and ending file names must be supplied.  
The file names must include frame numbers, and the frames
will be ordered by increasing number 
(not necessarily consecutive; missing numbers will be ignored).
</td></tr>
</table>
<p>
These input files can be gzipped.
</p><p>
The PDB options generally require coordinates for the same set of atoms to be 
supplied for each frame.  However, if the coordinates supplied for a 
frame represent only a subset of the atoms in the preceding frame, 
it will be inferred that the remaining atoms are present but have the
same coordinates as in the preceding frame.  Changes are cumulated
in the forward direction and based on all frames, even when frames
are skipped during playback (<a href="#step">step size</a> &gt; 1).
<p>
All or a contiguous subsegment of a trajectory can be loaded.
<a name="pipe">
If <b>pipe</b> is entered as the ending frame number</a>, 
the input trajectory will be read until it runs out, 
as long as no other input specifies a smaller ending frame number.  
For example, for a GROMOS trajectory,
the NSTLIM variable in the PROMD file should also be increased to at least
the total number of frames expected.  When a pipe has been specified,
there will be an attempt to load the entire trajectory up front.
</p><p>
A further option is a <a name="metafile"><b>metafile</b></a>, 
simply a text file that specifies the input files/parameters.
The first line designates trajectory type 
(where case is unimportant but any spaces should be stripped, for example, 
<b>namd(prmtop/dcd)</b> or <b>gromos</b>),
and optionally, starting and ending frame numbers of the range to be loaded.
A pipe can be specified as described <a href="#pipe">above</a>.
If no frame numbers are supplied, the entire trajectory will be loaded;
however, if "?" is given for both the starting and ending frame numbers,
a dialog for entering this information will appear.  
The remaining lines specify input files and
parameters in the same order as in the dialog.  For example:
<blockquote><pre>
amber 500 1000
dna.prmtop
dna.mdcrd
</pre></blockquote>
or:
<blockquote><pre>
pdb
single
108d.pdb
</pre></blockquote>
If input files are not in the same directory as the metafile,
their absolute pathnames or pathnames relative to the location of the metafile 
should be supplied.
A metafile can be opened directly from the 
<a href="../../UsersGuide/chimerawindow.html#emulator"><b>Command Line</b></a>
(or the system command line upon <a href="../../UsersGuide/startup.html">
startup</a>) using the prefix <b>md:</b> or <b>movie:</b>.  This will
start <b>MD Movie</b> and open the trajectory data.
</p>

<a name="viewing">
<h4>VIEWING FRAMES</h4>
</a>
<p>
After input files and parameters have been specified,
the first set of coordinates will be displayed and 
the <a name="controller"><b>MD Movie</b> controller</a> will appear:
</p>
<table border align="right" cellspacing="0" style="margin:8px 8px 8px 8px">
<tr><td><img src="movie2.png" alt="MD Movie controller"></td></tr>
</table>
<p>
If a subsegment was specified, a message about the
restricted frame range will be displayed temporarily. 
The total number of frames in the trajectory (whether loaded or not)
will continue to be reported.  
</p><p>
<a name="framesread">
For all <a href="#movieinput">input formats</a> except PDB and XYZ,
the coordinates for a given frame are not read in
until that frame is viewed or used for analysis.
</a>
</p><p>
From left to right, the buttons mean: play backward continuously;
go back one <a href="#step">step</a>; stop; 
go forward one <a href="#step">step</a>; 
and play forward continuously.  When the <b>Loop</b>
option is on, forward play can wrap from the end to the beginning
of the loaded trajectory and reverse play can wrap from the beginning
to the end.  
<a name="delay">The rate of continuous play can be adjusted</a> 
with the <b>Playback speed</b> slider; up to a 1-second delay
can be added between frame advances.  When continuous play is not in use,
the display can also be controlled by moving the pointer (inverted triangle) 
on the timeline or by entering a new <b>Frame</b> number.
The <a name="step"><b>Step size</b></a>
controls the level of sampling for continuous playback. For example, 
a step size of 3 indicates that only every third frame will be shown;
however, when forward play loops from end to beginning, the movie will
start at the first frame loaded, and when reverse play loops from beginning 
to end, the movie will start at the last frame loaded.
Frame number and step size changes take effect when
return (<b>Enter</b>) is pressed.
</p><p>
Frames can also be navigated by moving the black vertical line on a 
<a href="#plotting">distance or angle plot</a> or by using the command
<a href="../../UsersGuide/midas/coordset.html"><b>coordset</b></a>.
Pausing any continuous playback with the dialog is recommended 
before using these other methods.
</p>
<blockquote>
**&nbsp;Protein secondary structure assignments are not recomputed automatically
over the course of a trajectory.  If displaying protein as a
<a href="../../UsersGuide/representation.html#ribbon">ribbon</a>,
see the <a href="#ssnote">note</a> below.&nbsp;**
</blockquote>
<p>
The current frame or all frames that have been viewed
can be saved as a PDB file with
<a href="#moviefile"><b>File... Save PDB</b></a>.
The view can be <a href="#steady">held steady</a> on
<a href="../../UsersGuide/selection.html">selected</a> atoms.
One can define <a href="#per-frame">scripts</a>
to be executed at each frame update.
A complete menu listing with short descriptions is included 
<a href="#moviemenu">below</a>.
</p><p>
<b>Hide</b> closes the interface without exiting from <b>MD Movie</b>;
the interface can be reopened using the <b>Tools</b> menu entry 
for the <a href="../../UsersGuide/instances.html">instance</a> 
of <b>MD Movie</b>.  <b>Quit</b> exits from <b>MD Movie</b> and
removes the structure from the Chimera window.
<b>Help</b> opens this manual page in a browser window.
</p>

<a name="recording">
<h4>RECORDING A MOVIE</h4>
</a>
<p>
Images can be captured during 
trajectory playback and automatically assembled into a movie file.
Manipulations in Chimera can be performed and 
<a href="#per-frame">per-frame scripts</a> executed
during the playback/image-saving process.  
See also: 
<a href="../../UsersGuide/midas/coordset.html"><b>coordset</b></a>,
<a href="../../UsersGuide/movies.html">making movies</a>
<ul>
<b>Important notes</b>:
<a name="ssnote">
<li>Protein secondary structure assignments are not recomputed automatically 
over the course of a trajectory.</a>
If a protein or peptide is displayed as a
<a href="../../UsersGuide/representation.html#ribbon">ribbon</a> 
with secondary-structure-specific scaling (width and height)
and significant conformational changes are occurring, users may want to
reassign secondary structure at each frame.   
This can be done with a <a href="#per-frame">per-frame script</a>
that includes the Chimera command 
<a href="../../UsersGuide/midas/ksdssp.html"><b>ksdssp</b></a>.
<li>For a one-to-one relationship between trajectory frames and 
recorded image frames, the <a href="#delay"><b>Playback speed</b></a> slider
should be moved to the far right.  Otherwise, identical image frames 
will be inserted between the unique data frames to slow playback.
The frame number parameters described below refer only
to the unique data frames.  See also: 
<a href="../../UsersGuide/movies.html#speed">frame rate and movie speed</a>
<li>On certain platforms, other windows should not overlap
the Chimera graphics window during recording 
(<a href="../../UsersGuide/print.html#exception">details...</a>).
This is not an issue when <a href="#raytrace">raytracing</a> is used.
</ul>
<a href="#moviefile"><b>File... Record movie</b></a>
opens an interface for specifying image capture and movie assembly
parameters:  
<ul>
<li><b>File name</b> - name for the resulting movie file
<li><b>File type</b> (movie format) choices:
  <ul>
  <li>H.264 [.mp4]
  <li>VP8/WebM [.webm]
  <li>Theora [.ogv]
  <li>Quicktime [.mov]
  <li>AVI MSMPEG-4v2 [.avi]
  <li>MPEG-4 [.mp4]
  <li>MPEG-2 [.mpg]
  <li>MPEG-1 [.mpg]
  <li>WMV2 [.wmv]
  <li>APNG [.png] - animated PNG
(lossless, settings for <a href="#advanced"><b>quality</b></a> and
<a href="../../UsersGuide/midas/movie.html#bitrate"><b>bitrate</b></a>
do not apply)
  </ul>
<li><b>Starting frame</b> (first frame loaded, by default) 
- number of the first frame at which to save an image
<li><a name="moviesamp"><b>Step size [<i>n</i>]</b></a>
- level of sampling within the indicated range 
 (every <i>n</i><sup>th</sup> frame will be used)
<li><b>Ending frame</b> (last frame loaded, by default) 
- number of the last frame to possibly include (if not skipped by sampling);
must be within the range originally loaded
<li><b>Encode forward then backward ("roundtrip")</b> (true/<b>false</b>)
- whether to include the frames in reverse order as the second half
  of the movie
  <li><b>Rendering</b>:
    <ul>
    <li><b>Chimera</b> (default)
   - Chimera rendering, normally offscreen
   (<a href="../../UsersGuide/print.html#exception">details...</a>).
   Images can be supersampled, that is, initially generated at a 
   higher resolution and then sampled down to the final size.
      <ul>
      <li><b>Supersample</b> (1x1/2x2/<b>3x3</b>/4x4)
      - how many pixels to sample in the X and Y dimensions for each pixel in
      the final saved image; thus, 1x1 corresponds to no supersampling.
      Higher values increase the smoothness of edges in saved images and 
      increase calculation time with little effect on file size. 
      3x3 is generally recommended when supersampling is done.
      </ul>
    <li><a name="raytrace"><b>POV-Ray</b></a> 
  - <a href="../../UsersGuide/raytracing.html">raytrace with POV-Ray</a>.
  This rendering option is the slowest but includes fancier effects
  such as high-quality shadows.
  The <b>POV-Ray Options</b> button opens the corresponding
  <a href="../../UsersGuide/preferences.html#POV-Ray Options">preferences</a>.
    </ul>
</ul>
<a name="advanced"></a>
<b>Advanced Options</b>:
<ul>
  <li><b>Quality</b> (highest/higher/high/<b>good</b>/medium/fair/low)
- higher quality corresponds to higher (variable) playback bit rates and
  a larger movie file, assuming the same window size and movie frame rate
  <li><b>Image format</b> - image file format
(however, PNG will be used regardless of this setting if
<a href="#raytrace">raytracing</a> is done):
    <ul>
    <li>JPEG [.jpeg]
    <li>PNG [.jpeg]
    <li>PPM [.jpeg] (default)
    </ul>
<li><b>Additional recording options</b>
- options are the same as for the command
<a href="../../UsersGuide/midas/movie.html#record-options"><b>movie
record</b></a>
(include only the options, <i>e.g.</i> <b>directory ~/Desktop/images</b>,
not the <b>movie record</b> part);
if this field is left blank, image frames will be saved 
with default names in a default location 
(but normally deleted after movie encoding, depending on the encoding options)
<li><b><a name="encoding">Additional encoding options</a></b> 
- options are the same as for the command
<a href="../../UsersGuide/midas/movie.html#encode-options"><b>movie
encode</b></a> 
(include only the options, <i>e.g.</i> <b>resetMode keep</b>,
not the <b>movie encode</b> part);
if this field is left blank, 
the movie will be encoded to play at 25 frames per second,
and image frames will be deleted after the movie has been encoded
</ul>
Clicking <b>Record</b> plays the trajectory and saves image frames
according to the specified starting and ending points and step values.
The series of images is encoded as a movie file.  One duplicate image 
is included at the end to avoid a &ldquo;motion blur&rdquo; 
at the end of the movie.  Stopping playback with the 
<a href="#controller"><b>MD Movie</b> controller</a> in the middle of the 
playback/image-saving process will abort recording without 
generating a movie file.
</p><p>
<b>Close</b> closes the dialog without initiating recording.
<b>Image Tips</b> shows the <a href="../../UsersGuide/print.html#tips">tips 
on preparing images</a>, and
<b>Help</b> opens this manual page in a browser window.
</p>

<a name="per-frame">
<h4>PER-FRAME SCRIPTS</h4>
</a>
<p>
<a href="#movieperframe"><b>Per-Frame... Define script</b></a> allows
specification of a script to be executed at each trajectory frame.
Scripts can be written in <a href="../../UsersGuide/framecommand.html"
target="_top">Chimera commands</a> or Python code, and can
incorporate trajectory frame numbers.
Python scripts can also access the molecule model instance.  
<p><p>
Examples:
<ul>
<li>the following Chimera command script 
(<a href="eachFrame.com" type="text/plain">eachFrame.com</a>)
identifies hydrogen bonds at each frame and shows only the residues involved:
<pre>
<a href="../../UsersGuide/midas/chain.html">chain</a> @ca
<a href="../../UsersGuide/midas/display.html">~disp</a> solvent
<a href="../../UsersGuide/midas/hbonds.html">hb</a> line 2 color yellow reveal true
</pre>
Commands to be executed only at a specific frame can be indicated 
with a leading #<i>frame_num</i>: (for example, <b>#50:</b>) 
that will be stripped before the command is executed.
<br><br>
<li>the following Python script
(<a href="specificFrames.py" type="text/plain">specificFrames.py</a>)
initiates events at specific frames:
<pre>
from chimera import runCommand
frame = mdInfo['frame']
if frame == mdInfo['startFrame']:
        runCommand("<a href="../../UsersGuide/midas/roll.html">roll</a> y 3 40")
elif frame == 10:
        runCommand("<a href="../../UsersGuide/midas/color.html">color</a> green")
elif frame == 50:
        runCommand("<a href="../../UsersGuide/midas/color.html">color</a> orange")
        runCommand("<a href="../../UsersGuide/midas/rlabel.html">rl</a> :ala; <a href="../../UsersGuide/midas/color.html">color</a> dodger blue :ala; <a href="../../UsersGuide/midas/represent.html">rep</a> stick :ala")
elif frame == 90:
        runCommand("<a href="../../UsersGuide/midas/rlabel.html">~rl</a>; <a href="../../UsersGuide/midas/represent.html">rep</a> wire :ala")
else:
        runCommand("<a href="../../UsersGuide/midas/color.html">color</a> byhet")
</pre>
</ul>
For Python scripts, the chimera module is automatically imported.
</p><p>
<b>Note</b>:
Frame arguments in commands such as 
<a href="../../UsersGuide/midas/roll.html"><b>roll</b></a> refer to 
<b><i>image frames</i></b> rather than to unique data (trajectory) frames.
For a one-to-one correspondence between image and trajectory frames,
the <a href="#delay"><b>Playback speed</b></a> slider must be positioned 
all the way to the right and the viewing step size set to 1.
Whereas an <b>MD Movie</b> per-frame script executes at each trajectory frame, 
commands to be executed at each image frame (independent of any trajectory)
can be specified with the
<a href="../../UsersGuide/midas/perframe.html"><b>perframe</b></a> command.
The rate at which Chimera draws image frames can be controlled with
<a href="../../UsersGuide/midas/set.html#maxframerate"><b>set
maxFrameRate</b></a>.
<p><p>
<b>Insert text file</b> allows browsing to a text file and placing its contents
in the script area. <b>Save to file</b> saves the current contents of
the script area to a text file. 
</p><p>
<b>OK</b> and <b>Apply</b> execute the script with and without
closing the dialog, respectively.  If the movie is playing, the
script will continue to be executed for each trajectory frame until
<a href="#movieperframe"><b>Stop running script</b></a> is chosen;
if the movie is halted on a single frame, the script will be executed
for that frame and will not be executed again until a different frame is shown.
<b>Clear</b> deletes the contents of the script area.  <b>Close</b>
closes the dialog without executing the script, and <b>Help</b> opens
this manual page in a browser window.
</p>

<a name="plotting">
<h4>PLOTTING</h4>
</a>
<p>
<a href="#movieanal"><b>Analysis... Plot</b></a> allows plotting values
of structure measurements versus frame number:
<ul>
<li><b>Distances</b>
<li><b>Angles</b> (each defined by three atoms, not necessarily bonded)
<li><b>Dihedrals</b> (each defined by four atoms, not necessarily bonded)
<li><b>RMSD</b> 
(root-mean-square deviation of specified atoms relative to a reference frame)
</ul>
For distances and angles, the appropriate number of atoms 
(two, three, or four) should be
<a href="../../UsersGuide/selection.html">selected</a>.
</p><p>
RMSD calculations require specifying the atoms of interest and
the reference frame number.  
As in <a href="#rmsd">all-by-all RMSD analysis</a>, least-squares-fit RMSD
values are calculated without applying any transformation. 
The atoms can be specified by
<a href="../../UsersGuide/selection.html">selection</a> 
(where lack of selection indicates all atoms) in combination with the options:
<ul>
<li><b>Ignore solvent and non-metal ions</b> (<b>true</b>/false)
- whether to ignore
<a href="../../UsersGuide/midas/surface.html#surfcats">solvent</a> residues 
and monatomic anions (Cl<sup>&ndash;</sup>, Br<sup>&dash;</sup>, <i>etc.</i>)
<li><b>Ignore hydrogens</b> (<b>true</b>/false)
<li><b>Ignore metal ions</b> (<b>alkali</b>/true/false)
- whether to ignore alkali metal ions (Li<sup>+</sup>, Na<sup>+</sup>, 
K<sup>+</sup>, <i>etc.</i>), or all metal ions (if <b>true</b>), 
or none (if <b>false</b>, thus including any metal ions)
</ul>
Clicking <b>Plot</b> plots the measurement value versus trajectory frame number.
</p><p>
<a name="plotload">
If frames have not yet been viewed/loaded, a dialog will appear</a> with
the choices: load all frames (in the range specified in the initial input), 
load every <i>n</i><sup>th</sup> frame, or simply wait until a frame is viewed
to load it.  Loading via this dialog is faster than viewing/playing the whole
trajectory. If not all frames are loaded at this point, the plot will be
filled in with additional values as the trajectory is viewed.
<p></p>
All measurements of the same type (for example, distances) are placed in
a single plot.  The measurements are listed in a table to the right 
of the plot, with columns:
<ul>
<li>line color
(a <a href="../../UsersGuide/coloring.html#colorwell">color well</a>)
<li>whether <b>S</b>hown on the plot
<li>measurement value at the current frame
<li>for distances/angles: names of the atoms defining the measurement
<li>for RMSDs: reference frame and
number of atoms (per frame) used in the calculation
</ul>
One or more rows (measurements) can be chosen in the table by clicking
and dragging; the corresponding atoms will be
<a href="../../UsersGuide/selection.html">selected</a>.
<b>Ctrl</b>-click toggles the status of a single row.
Clicking <b>Delete</b> removes the chosen measurements from the
table and plot.  
</p><p>
Plots can be hidden individually using the
<img src ="../volumeviewer/x.png"> button above the table
or collectively by closing the dialog window. In either case, 
the plots have not been deleted and can be shown again using the 
<b>MD Movie</b> <a href="#movieanal"><b>Analysis... Plot</b></a> menu.
</p><p>
The current frame is indicated with a vertical black line on the plot.
Clicking elsewhere on the plot will reposition the line and 
jump to the corresponding frame, and playback can be controlled directly
by dragging the line.  Pausing any <a href="#viewing">continuous playback</a>
is recommended to facilitate such manual control over frame viewing.
</p><p>
Below each plot are standard
<a href="../saxs/saxs.html#plotnav">plot navigation icons</a>
provided by <a href="https://matplotlib.org/"
target="_blank">matplotlib</a>.  Images saved via the icon
<img src="../saxs/plot7.png" width="22"> 
will not include the vertical black line.
The <b>Dump Values</b> button at the bottom of the dialog allows 
saving measurements to a text file, using the number of decimal places
specified in <a href="../structuremeas/structuremeas.html"><b>Structure 
Measurements</b></a>.
</p>

<a name="occupancy">
<h4>OCCUPANCY ANALYSIS</h4>
</a>
<p>
It may be interesting to see which regions of space are highly populated 
by certain atoms relative to others in the trajectory or ensemble.
For example, cations or water hydrogens may tend to occupy space
around a negatively charged solute group.  
Occupancies can be represented as a three-dimensional grid of values,
or <b><i>volume data</i></b>.
<a href="#movieanal"><b>Analysis... Calculate occupancy</b></a> 
can be used to generate such data and display it with
<a href="../volumeviewer/framevolumeviewer.html" target="_top"><b>Volume
Viewer</b></a>. 
The occupancy map can be <a href="#saveocc">saved to a file</a> and later
reopened in Chimera.
</p><p>
The occupancy values are simply counts of how many times 
an atom in the specified set falls within a grid cell, 
except that the <a href="#atomrad">weighted-sphere option</a> 
may award increments of &gt;1 per atom.
Both <a href="#atomrad">sphere options</a> 
may increment multiple grid cells per atom.
</p><p>
Usually, one should first define a reference set of atoms
to hold steady (the trajectory frames will be transformed to keep
these atoms in the same place and orientation, as much as possible).
This is accomplished by 
<a href="../../UsersGuide/selection.html">selecting</a> 
the desired reference atoms and then choosing 
<a href="#movieactions"><b>Actions... Hold selection steady</b></a>.  
When the <a href="../../UsersGuide/selection.html">selection</a> 
is later changed, the "hold steady" atoms will not change unless 
<a href="#movieactions"><b>Actions... Hold selection steady</b></a>
is used again.
</p><p>
Next, one should <a href="../../UsersGuide/selection.html">select</a>
the atoms for which occupancy data will be collected.  The
atoms in the <a href="../../UsersGuide/selection.html">selection</a>
can be combined into a single set of occupancy data, or 
<a href="#separate">segregated</a>
by <a href="../../UsersGuide/idatm.html">atom type</a>.
<ul>
<li><b>Starting frame</b> (first frame loaded, by default) 
- number of the first frame to include in occupancy calculations; 
must be within the range originally loaded
<li><a name="occsamp"><b>Step size [<i>n</i>]</b></a>
- level of sampling within the indicated range 
 (every <i>n</i><sup>th</sup> frame will be used)
<li><b>Ending frame</b> (last frame loaded, by default) 
- number of the last frame to possibly include (if not skipped by sampling);
must be within the range originally loaded
<li><a name="limit"><b>Limit data collection to within cutoff distance of 
any "held steady" atoms</b></a> (<b>true</b>/false)
- whether data should be collected only
within the <a href="#cutoff">cutoff</a> distance of any atom in the prior
<a href="#steady">hold steady</a> specification.  This option is ignored
if there was no <a href="#steady">hold steady</a> specification.
<li><a name="cutoff"><b>Cutoff distance</b></a>
(<b>10.0</b> by default) - &Aring; distance used
to <a href="#limit">limit the volume data region</a>
to a zone around atoms in a prior
<a href="#steady">hold steady</a> specification
<li><a name="spacing"><b>Volume grid spacing</b></a>
(default <b>1.0</b> &Aring;) 
- resolution of the resulting volume data grid
<li><b>Volume data name</b> - name to use for
 the resulting volume data set(s); the name(s) will be listed in the
<a href="../volumeviewer/framevolumeviewer.html" target="_top"><b>Volume
Viewer</b></a> interface.  
For <a href="#separate">separate data sets</a> collected for different 
<a href="../../UsersGuide/idatm.html">atom types</a>,
the atom type symbol is enclosed in brackets and appended to the name.
<li><a name="separate"><b>Collect data separately for each atom type 
in selection</b></a> (<b>true</b>/false) 
- whether to make a separate set of volume data
for each <a href="../../UsersGuide/idatm.html">atom type</a> in the
<a href="../../UsersGuide/selection.html">selection</a>
<li><a name="atomrad"><b>Treat atoms as</b></a> 
- whether to consider atomic
<a href="../../UsersGuide/midas/vdwrad.html">VDW radii</a>
in occupancy calculations 
(the larger the <a href="#spacing">grid spacing</a> relative to the radii,
the smaller the differences in results among the options)
  <ul>
  <li><b>points</b> (default) -
  increment the count for each grid cell containing an atom center
  <li><b>uniform VDW spheres</b> - 
  increment the count for each grid cell with any part inside the
  <a href="../../UsersGuide/midas/vdwrad.html">VDW radius</a> of an atom
  <li><b>center-weighted VDW spheres</b> - 
  increment the count for each grid cell with any part inside the
  <a href="../../UsersGuide/midas/vdwrad.html">VDW radius</a> of an atom,
  but award cells in the outermost layer an increment of 1, 
  the next layer inward an increment of 2, the next layer 3, <i>etc.</i>
  A grid cell is in the outmost layer if it overlaps the atom sphere
  but any adjacent grid cell (including those diagonally adjacent) does not.
  </ul>
</ul>
<b>OK</b> collects occupancy data for the 
<a href="../../UsersGuide/selection.html">selected</a> atoms
according to the specified starting and ending points and step values,
with trajectory frames transformed according to a prior
<a href="#steady">hold steady</a> specification, if any.
The resulting data grid(s) are displayed with
<a href="../volumeviewer/framevolumeviewer.html" target="_top"><b>Volume
Viewer</b></a>. 
The dimensions of an occupancy grid will be the smallest
needed to enclose any nonzero values (which could be smaller than the 
<a href="#limit">region of data collection</a>).
<a name="saveocc">
The occupancy map can be saved to a file</a> using
<a href="../volumeviewer/volumeviewer.html#organization"><b>File... 
Save map as</b></a> in the 
<a href="../volumeviewer/framevolumeviewer.html" target="_top"><b>Volume
Viewer</b></a> menu.
</p><p>
<b>Close</b> closes the dialog without initiating the calculation.
<b>Help</b> opens this manual page in a browser window.
</p>

<a name="rmsd">
<h4>RMSD ANALYSIS</h4>
</a>
<a href="#movieanal"><b>Analysis... RMSD map</b></a>
can be used to generate a map of all-by-all pairwise
root-mean-square deviations (RMSDs) among specified frames.
See also:
<a href="#plotting">plotting RMSD</a> (vs. a single reference frame),
<a href="#clustering">clustering</a> a trajectory,
<a href="../ensemblematch/ensemblematch.html"><b>Ensemble Match</b></a>,
<a href="../../UsersGuide/midas/match.html"><b>match</b></a>
  <ul>
  <li><b>Starting frame</b> (first frame loaded, by default) 
  - number of the first frame to include
  in RMSD calculations; must be within the range originally loaded
  <li><a name="rmsdsamp"><b>Step size [<i>n</i>]</b></a>
  - level of sampling within the indicated range 
   (every <i>n</i><sup>th</sup> frame will be used)
  <li><b>Ending frame</b> (last frame loaded, by default) 
  - number of the last frame to possibly include (if not skipped by sampling);
  must be within the range originally loaded
  <a name="thresholds">
  <li><b>Lower RMSD threshold (white)</b> (<b>0.5</b> by default)
  - initial lower RMSD threshold for coloring, in &Aring;; 
  white will be used for this value and lower.
  If <a href="#recolor">auto-recoloring</a> is turned on,
  the threshold may change after all of the values have been computed.
  <li><b>Upper RMSD threshold (black)</b> (<b>3.0</b> by default)
  - initial upper RMSD threshold for coloring, in &Aring;; 
  black will be used for this value and higher.
  RMSD values between the thresholds will be mapped to grayscale.
  If <a href="#recolor">auto-recoloring</a> is turned on,
  the threshold may change after all of the values have been computed.
  </a>
  <li><b>Restrict map to current selection, if any</b>
  (<b>true</b>/false) - whether to use only the
  <a href="../../UsersGuide/selection.html">selected</a> atoms, when a
  <a href="../../UsersGuide/selection.html">selection</a> exists
<li><b>Ignore solvent and non-metal ions</b> (<b>true</b>/false)
- whether to ignore
<a href="../../UsersGuide/midas/surface.html#surfcats">solvent</a> residues 
and monatomic anions (Cl<sup>&ndash;</sup>, Br<sup>&dash;</sup>, <i>etc.</i>)
<li><b>Ignore hydrogens</b> (<b>true</b>/false)
<li><b>Ignore metal ions</b> (<b>alkali</b>/true/false)
- whether to ignore alkali metal ions (Li<sup>+</sup>, Na<sup>+</sup>, 
K<sup>+</sup>, <i>etc.</i>), or all metal ions (if <b>true</b>), 
or none (if <b>false</b>, thus including any metal ions)
  <li><a name="recolor"><b>Auto-recolor for contrast</b></a>
  (<b>true</b>/false) - whether the RMSD map should be recolored automatically
  after all values have been computed, using <a href="#thresholds">
  thresholds</a> that enclose the middle third of values (<i>i.e.</i>,
  the lowest third of values will be white, the middle third in grayscale,
  the highest third black)
  </ul>
<p>
<b>OK</b> and <b>Apply</b> initiate the calculations with and without
closing the dialog, respectively, while <b>Close</b> simply dismisses the
dialog.  <b>Help</b> opens this manual page in a browser window.
</p>
<table border="1" align="right" style="margin:8px 8px 8px 8px"
cellpadding="0" cellspacing="0">
<tr><td><img src="../../UsersGuide/tutorials/rmsdmap.png"></td></tr>
</table>
<p>
For each frame-to-frame comparison, the least-squares-fit RMSD between
the indicated sets of atoms will be calculated, without applying any
transformation.  The values will be shown as grayscale squares within an
<b><i>RMSD map</i></b>.  The calculations may require
additional frames to be read (frames within the loaded range
are not actually read until viewed or otherwise used)
and may take several minutes, depending on the size of the system
and the number of frames.  The <b>Abort</b> button at the bottom 
of the RMSD map dialog allows termination of a calculation in progress.  
To decrease computational time, use a sparser sampling of frames 
(larger step size) and/or fewer atoms in the calculation.
</p><p>
Multiple RMSD maps can be open at the same time.
<a name="changethresh">A given map can be recolored</a>
(without recalculation of RMSD values) using the map's menu option 
<b>RMSD...  Change thresholds</b> to adjust the white/black
<a href="#thresholds">threshold settings</a>.
When the cursor is placed over a map,
the corresponding frame numbers and RMSD value are given below the map.
Clicking on a map places the corresponding 
frame numbers in the <b>Frame</b> fields; clicking <b>Go</b>
will show the corresponding frame of the trajectory in the graphics window.
</p><p>
Below the plot are standard
<a href="../saxs/saxs.html#plotnav">navigation icons</a>
provided by <a href="https://matplotlib.org/"
target="_blank">matplotlib</a>.
</p><p>
Other buttons on the RMSD map dialog:
<ul>
<li><b>Save RMSDs</b> - save the matrix of RMSD values to a text file
<li><b>Close</b> - dismiss/delete the RMSD map
<li><b>Help</b> - show this manual page in a browser window
</ul>
Alternatively, the
<a href="../ensemblematch/ensemblematch.html"><b>Ensemble Match</b></a> tool
can be used to calculate all-by-all pairwise RMSD values for an ensemble
read from a single PDB file.  The file would need to be
<a href="../../UsersGuide/filetypes.html">opened in a standard way</a>
rather than with <b>MD Movie</b>.  Unlike <b>MD Movie</b>,
<a href="../ensemblematch/ensemblematch.html"><b>Ensemble Match</b></a> 
can perform the corresponding pairwise superpositions (<i>i.e.</i>
match one structure to another), but its use is impractical for
ensembles with very many members.
</p>

<a name="clustering">
<h4>CLUSTERING</h4>
</a>
<a href="#movieanal"><b>Analysis... Cluster</b></a> can be used to cluster 
the trajectory based on pairwise best-fit root-mean-square deviations (RMSDs).
A representative frame will be identified for each cluster.
For more about the method, see
<a href="../ensemblecluster/ensemblecluster.html"><b>Ensemble Cluster</b></a>.
See also: <a href="#rmsd">RMSD analysis</a>
  <ul>
  <li><b>Starting frame</b> (first frame loaded, by default) 
  - number of the first frame to include
  in clustering calculations; must be within the range originally loaded
  <li><b>Step size [<i>n</i>]</b>
  - level of sampling within the indicated range 
   (every <i>n</i><sup>th</sup> frame will be used)
  <li><b>Ending frame</b> (last frame loaded, by default) 
  - number of the last frame to possibly include (if not skipped by sampling);
  must be within the range originally loaded
  <li><b>Cluster based on current selection, if any</b>
  (<b>true</b>/false) - whether to limit calculations to only the 
  <a href="../../UsersGuide/selection.html">selected</a> atoms, 
  when a <a href="../../UsersGuide/selection.html">selection</a> exists
<li><b>Ignore solvent and non-metal ions</b> (<b>true</b>/false)
- whether to ignore
<a href="../../UsersGuide/midas/surface.html#surfcats">solvent</a> residues 
and monatomic anions (Cl<sup>&ndash;</sup>, Br<sup>&dash;</sup>, <i>etc.</i>)
<li><b>Ignore hydrogens</b> (<b>true</b>/false)
<li><b>Ignore metal ions</b> (<b>alkali</b>/true/false)
- whether to ignore alkali metal ions (Li<sup>+</sup>, Na<sup>+</sup>, 
K<sup>+</sup>, <i>etc.</i>), or all metal ions (if <b>true</b>), 
or none (if <b>false</b>, thus including any metal ions)
  </ul>
<p>
<b>OK</b> and <b>Apply</b> initiate the calculations with and without
closing the dialog, respectively, whereas <b>Close</b> simply dismisses the
dialog.  <b>Help</b> opens this manual page in a browser window.
</p><p>
For each frame-to-frame comparison, the least-squares-fit RMSD between
the indicated sets of atoms will be calculated, without applying any
transformation.  The calculations may require
additional frames to be read (frames within the loaded range
are not actually read until viewed or otherwise used)
and may take several minutes, depending on the size of the system
and the number of frames.  The <b>Abort</b> button on the progress dialog
allows terminating the calculation.  To decrease computational time, 
use a sparser sampling of frames and/or fewer atoms in the calculation.
</p>

<table border align="right" cellspacing="0" style="margin:8px 8px 8px 8px">
<tr><td><img src="cluster.png" alt="trajectory cluster dialog"></td></tr>
</table>

<a name="clusterdialog">
<h4>Trajectory Cluster Dialog</h4></a>
<p>
Clustering results are shown in a dialog. The top part of the dialog 
lists the clusters, and for each, the number of <b>Members</b>
(how many of the input frames belong to the cluster) 
and the frame number of the best representative.  
Different colors are used to show membership in the different clusters 
within the timeline plot in the bottom part of the dialog.
The color used for a cluster can be changed by clicking its
<a href="../../UsersGuide/coloring.html#colorwell">color well</a> and 
using the <a href="../../UsersGuide/colortool.html"><b>Color Editor</b></a>.
</p><p>
Clicking the line for a cluster in the top part of the dialog
displays its representative frame in the main window 
and makes the bars for all of the members of that cluster taller
on the timeline plot.  The current frame is indicated with an 
inverted triangle on the plot, and the trajectory can be navigated
by moving the triangle, 
just as in the <b>MD Movie</b> <a href="#viewing">controller dialog</a>. 
Although more than one cluster can be chosen with the mouse in the 
top part of the dialog, only one frame can be displayed at a time.
</p>
<ul>
<li><b>Generate average structure for cluster</b> -
calculate an <a href="#averaging">average structure</a> 
for a single cluster chosen in the top part of the dialog
<li><b>Generate residue-interaction network for cluster</b>
- calculate and display (with
<a href="https://cytoscape.org/" target="_blank">Cytoscape</a>)
a residue interaction network (RIN) for a single chosen cluster
(<a href="#rins">details</a>)
<li><b>Generate residue-interaction difference network for cluster pair</b>
- calculate and display a RIN in which the edge values are differences
in interaction frequencies between two chosen clusters
(<a href="#rins">details</a>)
</ul>
<p>
Below the plot are standard
<a href="../saxs/saxs.html#plotnav">navigation icons</a>
provided by <a href="https://matplotlib.org/"
target="_blank">matplotlib</a>.
</p><p>
<b>Save</b> allows writing the clustering information 
(membership and representatives) to a text file.
<b>Close</b> dismisses the cluster dialog.
<b>Help</b> opens this manual page in a browser window.
</p>

<a name="averaging">
<h4>STRUCTURE AVERAGING</h4>
</a>
<p>
An average structure can be computed for the whole trajectory 
or user-specified frame ranges with
<a href="#movieanal"><b>Analysis... Average structure</b></a> in the
<b>MD Movie</b> menu, or for a chosen cluster
by clicking the <b>Generate average structure...</b> button
in the <a href="#clusterdialog">cluster dialog</a>.
</p><p>
A simple average of the Cartesian (x,y,z) coordinates of the biopolymeric
components of the trajectory (proteins/peptides and nucleic acids) 
is calculated and the result opened as a new model.  
The average structure may be distorted,
especially in conformationally variable areas.
</p><p>
Choosing <a href="#movieanal"><b>Analysis... Average structure</b></a> 
opens a dialog with the following options:
<ul>
<li><b>Starting frame</b> (first frame loaded, by default) 
- number of the first frame to include in averaging
<li><b>Step size [<i>n</i>]</b>
- level of sampling within the indicated range 
 (every <i>n</i><sup>th</sup> frame will be used)
<li><b>Ending frame</b> (last frame loaded, by default) 
- number of the last frame to possibly include (if not skipped by sampling);
must be within the range originally loaded
</ul>
The following also apply to cluster averaging:
<ul>
<li><b>Align structures based on current selection, if any</b>
(<b>true</b>/false)
- align the frames to be averaged by matching the 
<a href="../../UsersGuide/selection.html">selected</a> atoms
<li><b>Omit hydrogens</b> (<b>true</b>/false)
- whether to omit hydrogens from the average structure
<li><b>Include metal ions</b> (true/<b>non-alkali</b>/false)
- which metal ions to include in the average structure: 
all, all non-alkali (default, omitting Li<sup>+</sup>, 
Na<sup>+</sup>, K<sup>+</sup>, <i>etc.</i>), or none
<li><b>Name average structure</b> (default <b>average</b>)
- name for the new model
</ul>
Clicking <b>OK</b> calculates the average structure and opens it as a new model.
</p>

<a name="rins">
<h4>RESIDUE INTERACTION NETWORKS</h4>
</a>
<p>
A residue interaction network (RIN) summarizing 
part or all of a trajectory can be calculated and shown as a 2D diagram in 
<a href="https://cytoscape.org/" target="_blank">Cytoscape 3</a>.
In the network diagram, nodes represent residues and edges represent
interactions between pairs of residues. Currently, this feature
requires starting Chimera from inside Cytoscape, namely:
<ol>
<li>obtaining <a href="https://cytoscape.org/" target="_blank">Cytoscape 3</a>
and starting it
<li>
<a href="https://www.rbvi.ucsf.edu/cytoscape/structureViz2/index.shtml#install"
target="_blank">installing</a> the Cytoscape app
<a href="https://www.rbvi.ucsf.edu/cytoscape/structureViz2/index.shtml"
target="_blank"><i>structureViz2</i></a> (if not already installed)
<li>from the Cytoscape menu, choosing <b>Apps... StructureViz... 
Launch Chimera</b>
<br>(the path to the Chimera executable can be specified via
<b>Apps... StructureViz... Settings</b>)
<li>in the resulting instance of Chimera, <a href="#top">starting</a> 
<b>MD Movie</b> and reading in the trajectory
<li>starting a RIN calculation from <b>MD Movie</b> by either of the
following:
  <ul>
  <li>from the <b>MD Movie</b> menu, choosing
  <a href="#movieanal"><b>Analysis... Residue interaction network</b></a>
  <li>after <a href="#clustering">clustering</a>, clicking one of the 
  RIN-creation buttons on the <a href="#clusterdialog">trajectory
  cluster dialog</a>
  </ul>
</ol>
RIN calculation options 
(the first three are omitted for <a href="#clusterdialog">cluster RINs</a>):
<ul>
<li><b>Starting frame</b> (first frame loaded, by default) 
- number of the first frame to include in averaging
<li><b>Step size [<i>n</i>]</b>
- level of sampling within the indicated range 
 (every <i>n</i><sup>th</sup> frame will be used)
<li><b>Ending frame</b> (last frame loaded, by default) 
- number of the last frame to possibly include (if not skipped by sampling);
must be within the range originally loaded
<li><b>Type of residue interactions</b>
  <ul>
  <li><b>H-bonds</b> (default) - identify hydrogen bonds; 
  explicit hydrogen atoms are not required
  <li><b>contacts</b> - identify contacts of all kinds 
  based on distances and VDW radii
  </ul>
<li><a name="rin-weighting"><b>Weight interactions by number of
H-bonds/contacts formed</b></a>
(<b>true</b>/false)
- whether to count multiple interactions between the same pair of residues
in a frame or to simply mark them as interacting or not
  <ul>
  <li>with weighting, the resulting edge value will be the average number of
  interactions per frame between a pair of residues
  <li>without weighting, the resulting edge value will be the fraction 
  of frames in which the residues interact
  </ul>
<li><b>Ignore H-bonds/contacts between covalently bonded residues</b>
(<b>true</b>/false)
<li><b>Group solvent as one node</b> (<b>true</b>/false)
- whether to represent all
<a href="../../UsersGuide/midas/surface.html#surfcats">solvent</a> residues 
as a single node in the network
<li><b>Group ions as one node</b> (<b>true</b>/false)
- whether to represent all 
<a href="../../UsersGuide/midas/surface.html#surfcats">ions</a>
as a single node in the network
<li><b>Weighted discard-edge threshold</b> (default <b>0.5</b>)
- discard network edges representing pairs of residues with less than 
the specified average number of interactions per frame
<br>&mdash; OR (if <a href="#rin-weighting">weighting</a> is not used) &mdash;
<li><b>Discard-edge threshold</b> (default <b>0.25</b>)
- discard network edges representing pairs of residues that interact
in less than the specified fraction of frames; 
for example, if the threshold is 0.25, edges will not be drawn 
between residues that interact in &lt;25% of the sampled frames.
In a <a href="#clusterdialog">cluster difference RIN</a>,
an edge will only be discarded if its value is below the specified
threshold in <i>both</i> clusters.
</ul>
Clicking <b>Apply</b> or <b>OK</b> (which also dismisses the dialog) brings up
a secondary dialog for setting H-bond or contact detection parameters.
</p><blockquote>
<a name="rin-hbonds"></a>
For H-bonds (see
<a href="../findhbond/findhbond.html"><b>FindHBond</b></a> for details):
<ul>
<li><b>Relax H-bond constraints</b></a> 
- whether to apply tolerances to the precise
<a href="../findhbond/findhbond.html#criteria">geometric criteria</a>;
the defaults of <b>0.4</b> &Aring; and <b>20.0</b>&deg; work well in most cases
<li><b>Only find H-bonds</b>
- whether to limit H-bond detection based on the current
<a href="../../UsersGuide/selection.html">selection</a>:
  <ul>
  <li><b>with at least one end selected</b>  
  <li><b>with exactly one end selected</b> 
  <li><b>with both ends selected</b> 
  <li><b>between selection and atom spec...</b> 
  [ <a href="../../UsersGuide/midas/frameatom_spec.html" 
  target="_top"><i>atom-spec</i></a> ]
  </ul>
</ul>
<a name="rin-contacts"></a>
For contacts (see
<a href="../findclash/findclash.html"><b>Find Clashes/Contacts</b></a>
for details):
<ul style="list-style-type:none">
<li><b>Atoms to Check</b> are specified by
<a href="../../UsersGuide/selection.html">selecting</a> atoms,
clicking <b>Designate</b>, and indicating which interactions should be found:
  <ul>
  <li><b>themselves</b> - interactions among the designated atoms
  <li><b>all other atoms</b> (default) - interactions between the designated
  atoms and all other atoms
  <li><b>other atoms in same model</b> - intra-model interactions between
  the designated atoms and all other atoms
  <li><b>second set of designated atoms</b> - interactions between
  the designated atoms and a second designated set (specified by
  <a href="../../UsersGuide/selection.html">selecting</a> atoms and
  clicking <b>Designate selection as second set</b>)
  </ul>
Changing the <a href="../../UsersGuide/selection.html">selection</a>
will not automatically change any designated sets.
</p><p>
<li><b>Clash/Contact Parameters</b></a> control what will be considered a 
<b><i>clash</i></b> (unfavorable interaction with atoms too close together)
or <b><i>contact</i></b> (any direct interaction, favorable or unfavorable, 
based on proximity):
  <ul>
  <li><b>Find atoms with VDW overlap >=[ <i>cutoff</i> ] angstroms</b>
  - pairs of atoms with <a href="#overlap"><i>overlap</i></a>
  &ge; <i>cutoff</i> will be identified.
  A larger positive <i>cutoff</i> restricts the results to more severe
  clashes, whereas a negative <i>cutoff</i> can also identify
  favorable contacts. Zero is where the VDW surfaces exactly touch
  (at least for non-H-bonding atoms, see below).
  <li><a name="allowance"><b>Subtract [ <i>allowance</i> ]
  from overlap for potentially H-bonding pairs</b></a>
  - an <i>allowance</i> &gt; 0
  reflects the observation that atoms sharing a hydrogen bond can come
  closer to each other than would be expected from their VDW radii.
  The <i>allowance</i> is only subtracted for pairs
  comprised of a donor (or donor-borne hydrogen) and an acceptor.
<p>
Thus, the <a name="overlap"><b><i>overlap</i></b></a>
between two atoms is defined as the sum of their
<a href="../../UsersGuide/midas/vdwrad.html">VDW radii</a> minus the
distance between them and minus an <a href="#allowance">allowance</a>
for potentially hydrogen-bonded pairs:
  <blockquote>
  <i>overlap<sub>ij</sub></i> =
  r<sub>VDW<i>i</i></sub> + r<sub>VDW<i>j</i></sub>
  &ndash; d<sub>ij</sub> &ndash; <i>allowance<sub>ij</sub></i>
  </blockquote>
Default <b>clash</b> criteria are <i>cutoff</i> <b>0.6</b> &Aring;
and <i>allowance</i> <b>0.4</b> &Aring;.
</p><p>
Default <b>contact</b> criteria are <i>cutoff</i> <b>&ndash;0.4</b> &Aring; 
and <i>allowance</i> <b>0.0</b> &Aring;.
This means pairs of atoms with VDW surfaces up to 0.4 &Aring; apart will
be identified.
</p>
  <li><b>Ignore contacts of pairs [ <i>N</i> ] or fewer bonds apart</b>
  (<i>N</i>=<b>4</b> by default)
  <li><b>Include intra-residue contacts</b> (default off)
  <li><b>Include intra-molecule contacts</b> (default on)
  - whether to include intramolecular interactions,
  where a molecule is defined as a covalently bonded set of atoms
  </ul>
</ul>
</blockquote>
Clicking <b>OK</b> on the secondary (H-bond or contact parameters)
dialog calculates the RIN and brings up 
<a name="rin-colors"></a>
a dialog for specifying network edge coloring and name:
<ul style="list-style-type:none">
<li><b>Edge weight to edge color mapping</b>
shows the distribution of network edge values as a histogram,
with vertical bars (sliders) that can be moved and/or recolored to
define how the edges should be colored based on their values.
Clicking on a slider shows its <b>Value</b> in black.
Clicking elsewhere within the histogram shows the <b>Value</b>
(X-coordinate) of the mouseclick in gray.
A slider can be moved by dragging it horizontally or
by editing its <b>Value</b> directly. Holding the Shift
key down reduces the speed (mouse sensitivity) of
dragging tenfold, allowing finer control.
A slider can be added by Ctrl-clicking on the histogram, and Ctrl-clicking
on an existing slider deletes it.
The <b>Color</b> applies to the slider most recently moved or clicked;
clicking the square
<a href="../../UsersGuide/coloring.html#colorwell">color well</a> opens
the <a href="../../UsersGuide/colortool.html"><b>Color Editor</b></a>
for choosing a color interactively.
</ul><ul>
<li><b>Edge width</b> (1/2/3/4/<b>5</b>/6/7/8/9/10)
- linewidth of edges in Cytoscape; 
all edges in a network will be the same width, regardless of their values
<li><b>Network name</b>: [<i>name</i>]
- name of the network in Cytoscape (default <b>MD residue interactions</b>)
</ul>
Clicking <b>Apply</b> or <b>OK</b> (which also dismisses the dialog) 
opens the RIN with the specified edge coloring, edge width, and
name in Cytoscape. The Cytoscape and Chimera views are linked by
<a href="https://www.rbvi.ucsf.edu/cytoscape/structureViz2/index.shtml"
target="_blank"><i>structureViz2</i></a>.
</p>

<a name="moviemenu">
<h4>MD MOVIE MENU</h4>
</a>

<a name="moviefile">
<h4>File</h4></a>
<ul>
<li><b>Save PDB...</b> open a
<a href="../../UsersGuide/modelpanel.html#writepdb">dialog</a>
to save the current frame or all frames that have been viewed
as a PDB file
<li><b>Record movie...</b> set parameters for saving
image frames and encoding them as a movie file
<li><a name="loadmore"><b>Load Additional Frames...</b></a>
(only available for Amber trajectories and DCD files,
see <a href="#movieinput">formats</a>)
read an additional trajectory file and append its frames to the end of 
the current trajectory 
</ul>

<a name="movieactions">
<h4>Actions</h4></a>
<ul>
<li><a name="steady"><b>Hold selection steady</b></a>
- transform subsequent trajectory frames to keep
the <a href="../../UsersGuide/selection.html">selected</a> atoms
in the same place and orientation, as much as possible (since the
atoms may move relative to one another).  For best results,
the selection should include at least three atoms, not linearly arranged,
to define a frame of reference.
If the selection is changed, <b>Hold selection steady</b> must be chosen
again to start using the new selection.
<br><br>
<li><b>Stop holding steady</b>
- return to the default behavior of only
transforming the coordinates according to user manipulations and commands
</ul>

<a name="movieperframe">
<h4>Per-Frame</h4></a>
<ul>
<li><b>Define script...</b> open a dialog for
entering a <a href="#per-frame">script</a>
(written in <a href="../../UsersGuide/framecommand.html"
target="_top"><b>Chimera commands</b></a> or <b>Python</b> code)
to be executed after each trajectory frame update.
<b>OK</b> and <b>Apply</b> execute the script with and without
closing the dialog, respectively.  If the movie is playing, the
script will continue to be executed for each trajectory frame until
<b>Stop running script</b> is chosen.
<li><b>Stop running script</b>
- do not run the script after subsequent trajectory frame updates
</ul>

<a name="movieanal">
<h4>Analysis</h4></a>
<ul>
<li><b>Plot...</b> measure and plot distances, angles, dihedrals, 
and/or RMSD values over the trajectory (<a href="#plotting">details</a>)
<li><b>Calculate occupancy...</b> collect and display (with
<a href="../volumeviewer/framevolumeviewer.html" target="_top"><b>Volume
Viewer</b></a>) occupancy data for the
<a href="../../UsersGuide/selection.html">selected</a> atoms
over a specified set of frames
(<a href="#occupancy">details</a>)
<li><b>Cluster...</b> cluster the trajectory based on 
all-by-all RMSD comparisons among specified frames
(<a href="#clustering">details</a>)
<li><b>RMSD map...</b>
calculate a two-dimensional RMSD map containing 
all-by-all comparisons among specified frames
(<a href="#rmsd">details</a>)
<li><b>Average structure...</b>
calculate a Cartesian average structure over specified frames
(<a href="#averaging">details</a>)
<li><b>Residue interaction network...</b>
calculate and display (with
<a href="https://cytoscape.org/" target="_blank">Cytoscape</a>)
a residue interaction network (RIN) over specified frames
(<a href="#rins">details</a>)
</ul>

<a name="newformats">
<h4>ADDING A FORMAT</h4>
</a>
<p>
<b>MD Movie</b> uses the Trajectory module to read the various formats
(<b><i>chimera</i>/share/Trajectory</b>, where <b><i>chimera</i></b>
is the Chimera installation location). <b>Trajectory</b>
contains a subdirectory, <b>formats</b>, which in turn contains 
subdirectories that each correspond to the Python module for a 
supported format. By convention, the module (and directory)
name for each format is the name of the format with the first letter of 
each word capitalized and all other letters lowercase.  For example,
the MMTK module's name is <b>Mmtk</b>.
</p><p>
A format's module is typically structured so that the code that 
interfaces with Trajectory's generic format handling is in
<a href="#initfile"><b>__init__.py</b></a>, 
and the code specific to reading a particular format is in
<a href="#specificfile">another python file</a>,
usually named after the format itself (for example, <b>Gromos.py</b>).
</p><p>
<a name="initfile"><b>__init__.py</b></a> must support the following:
<ul>
<li>If the format name displayed to the user should be different
from the module name (usually it should, due to capitalization), then 
there must be a global variable named <var>formatName</var> that is 
initialized to the display name of the format.

<li>A class named <var>ParamGUI</var> must be defined 
to handle presenting the file-loading interface to the user.
It must have two methods:
 <ul>
   <li><var>__init__</var>, which receives a <var>Tkinter.Frame</var>
instance argument.  The <var>__init__</var> method should populate the frame
with widgets for gathering the input information for the format from the user.

   <li><var>loadEnsemble</var>, which takes as arguments 
a starting frame number, ending frame number, and callback function.
<var>loadEnsemble</var> needs to compose a list of the arguments 
that were provided by the user to the widgets defined in 
<var>__init__</var>, and then call this module's 
global <var>loadEnsemble</var> function (see below) with that list as the first 
argument and the start/end frame number and callback as the remaining 
three arguments.
  </ul>
<li> A global <var>loadEnsemble</var> 
function that generates an <var>ensemble</var> instance 
(discussed later).  This function is not only called by the 
<var>ParamGUI.loadEnsemble</var> method, but also when
a <a href="#metafile">metafile</a> is used to specify the input parameters.  
This function takes four arguments:  
a format-specific list of input parameters, a starting frame number, 
an ending frame number, and a callback function to start the <b>MD Movie</b> 
interface.  The global <var>loadEnsemble</var> function
should call the interface with the generated ensemble 
as an argument, and should remember the provided 
format-specific values as preferred defaults for 
future uses of the format.
</ul>
<b>__init__.py</b> files are very similar from format to format.
The simplest way to generate a new <b>__init__.py</b> file
is to copy and modify another format's.
Gromos format provides a good example, as it
involves multiple input files and a non-file parameter.
</p><p>
The <a name="specificfile"><b>format-specific .py file</b></a>
defines an <var>ensemble</var> class that gets instantiated from 
<b>__init__.py</b>'s <var>loadEnsemble</var> function.  
The <var>ensemble</var> class must support the following methods:
<ul>
<li> An <var>__init__</var> method that takes the format's input parameters and 
start/end frames as arguments.  The <var>__init__</var> method may read input 
files or do whatever is necessary to support the other instance methods 
(such as call into a C/C++ module to read the files, as is done for
Amber format).
<li> A <var>GetDict</var> method that takes a string argument.  The string 
specifies what data should be returned.  The possible string values are:
  <ul>
  <li> <var>atomnames</var> - return a list of the atom names; a residue's 
atoms must be consecutive
  <li> <var>elements</var> - return a list of the atom elements.  These should 
be instances of <var>chimera.Element</var> 
(which can be initialized with a string such as "Fe" or a number).
Trajectory's <var>determineElementFromMass</var>
function may be useful if the format does not specify the atomic 
number directly or it cannot be determined easily from the atom name.
  <li> <var>resnames</var> - return a list of the residue names
  <li> <var>bonds</var> - return a list of bonds (2-tuples of indices into 
the <var>atomnames</var> list)
  <li> <var>ipres</var> - a list of the first atom of each residue (indices 
into <var>atomnames</var>, but unlike previous indices these are 
1-based, so the first element of <var>ipres</var> will always be 1)
  </ul>
<li> A <var>__getitem__</var> method taking a frame-number argument 
(starting with 1):  return a list of 3-tuples corresponding to the 
xyz coordinates of the atoms in that frame 
(in the same order as <var>atomnames</var>).  
The coordinates should be in &Aring;.

<li> A <var>__len__</var> method that returns the total number of 
frames in the trajectory (not just the number of frames between the 
user-specified start/end frames).
</ul>
</p>
<hr>
<address>UCSF Computer Graphics Laboratory / December 2021</address>
</body>
</html>
