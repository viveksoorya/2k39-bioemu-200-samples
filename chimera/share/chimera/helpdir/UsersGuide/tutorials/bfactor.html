<!--
--- UCSF Chimera Copyright ---
Copyright (c) 2009-2014 Regents of the University of California.
All rights reserved.  This software provided pursuant to a
license agreement containing restrictions on its disclosure,
duplication and use.  This notice must be embedded in or
attached to all copies, including partial copies, of the
software or any revisions or derivations thereof.
--- UCSF Chimera Copyright ---
-->

<html><head>
<title>Image Tutorial: B-Factor Coloring</title>
</head><body>
<font size="-1">
<a href="../frametut.html" target="_top">Chimera Tutorials Index</a>
</font>

<h2>Image Tutorial: B-Factor Coloring</h2>

<table align="right" style="margin:8px 8px 8px 8px" 
cellpadding="0" cellspacing="0">
<tr>
<td><a href="2gbp-bfactor.png"><img src="2gbp-bfactor.png" width="250"
height="193" title="click for full-sized image..."></a></td>
</tr>
</table>
</a>

<p>
The recipe here is just one possibility; there are usually several ways 
to get the same or similar results.
See also:
<a href="../menu.html#menupresets">presets</a>,
<a href="../print.html#tips">tips on preparing images</a>
</p><p>
<a href="../startup.html">Start Chimera</a> and
show the <a href="../chimerawindow.html#emulator"><b>Command Line</b></a>
(for example, with <b>Favorites... Command Line</b>).
Fetch Protein Data Bank entry
<a href="https://www.rcsb.org/structure/2GBP" target="_blank">2gbp</a>: 
<blockquote>
<i>Command</i>: <b><a href="../midas/open.html">open</a> 2gbp</b>
</blockquote>
Use the &ldquo;all atoms&rdquo; preset and delete the water:
<blockquote>
<i>Command</i>: <b><a href="../midas/preset.html">preset</a> apply int 2</b>
<br>
<i>Command</i>: <b><a href="../midas/delete.html">delete</a> solvent</b>
</blockquote>
Resize the window as desired, either by dragging its lower right corner 
with the mouse or by using the command
<a href="../midas/windowsize.html"><b>windowsize</b></a>. 
The window dimensions define the aspect ratio (width:height)
of output images, but image resolution (pixel dimensions)
can be specified independently when an image is saved.
</p><p>
The <a href="2gbp-bfactor.png">example image</a> was saved with pixel 
dimensions 573 x 443 from a window of that same size:
<blockquote>
<i>Command</i>: <b><a href="../midas/windowsize.html">windowsize</a> 573 443</b>
</blockquote>
Move and scale the structure <a href="../mouse.html">using the mouse</a> and the
<a href="../sideview.html#sideview"><b>Side View</b></a>
as you wish throughout the tutorial.
</p>

<h3>Coloring by B-Factor</h3>
<p>
Start <a href="../../ContributedSoftware/render/render.html#render"><b>Render
by Attribute</b></a> (under <b>Tools... Depiction</b>) and make sure it is
set to show the <a href="../../ContributedSoftware/defineattrib/defineattrib.html#attribdef">attributes</a> of <b>atoms</b>.  
Look in the <b>Attribute</b> list to see what is available: 
<b>bfactor</b> and <b>occupancy</b>, which were read from the input PDB file.
Choose <b>bfactor</b>; a histogram of the values will
appear, with blue, white and red vertical bars (or 
<a href="../../ContributedSoftware/render/render.html#thresh">thresholds</a>).
</p><p>
You can control how colors will map to B-factor values
by dragging the thresholds along the histogram and/or changing their colors.
The <b>Value</b> and <b>Color</b> are shown for the
most recently clicked or moved threshold.  The <b>Value</b> changes
when the threshold is moved, or the position can be changed by
entering a value and pressing return. The <b>Color</b> can be changed
by clicking the square <a href="../coloring.html#colorwell">color well</a>
and using the <a href="../colortool.html"><b>Color Editor</b></a>.
The slider positions in the editor can be adjusted, or a
<a href="../colortables.html#allcolors">color name</a> 
simply entered in the <b>Color name</b> field.
</p><p>
To make the <a href="2gbp-bfactor.png">example image</a>, 
a <b>blue</b> threshold at value 2, a <b>red</b> threshold at 30, 
and a <b>yellow</b> threshold at 50 were used.
Clicking <b>Apply</b> shows the currently defined color scheme on the
structure.  Once you have the desired coloring, click 
<b>Create corresponding color key</b>, but then just <b>Close</b> both the 
<a href="../../ContributedSoftware/2dlabels/2dlabels.html#colorkey"><b>Color
Key</b></a> and
<a href="../../ContributedSoftware/render/render.html#render"><b>Render
by Attribute</b></a> dialogs.
Although the color key has now been set up to match the coloring scheme, 
we will not draw it in the Chimera window until later.
</p><p>
Alternatively, instead of the graphical interface, 
a command could have been used to perform the coloring:
<blockquote>
<i>Command</i>: <b><a href="../midas/rangecolor.html">rangecolor</a> bfactor key 2 blue 30 red 50 yellow</b>
</blockquote>
The <b>key</b> keyword sets up the
<a href="../../ContributedSoftware/2dlabels/2dlabels.html#colorkey"><b>Color
Key</b></a> dialog; as above, just close that dialog for now.
While the command approach is more concise, the 
<a href="../../ContributedSoftware/render/render.html#render"><b>Render
by Attribute</b></a> graphical interface is friendlier in that it
does not require previous knowledge of the attribute names, and it provides 
visual (histogram) information on the value distribution.
</p><p>
The coloring can be limited to certain representations, but in this example,
both the atoms and the molecular surface (not yet shown)
have been colored by <b>bfactor</b> value.
</p>

<h3>Clipping the Surface</h3>
<p>
Display the molecular surface:
<blockquote>
<i>Command</i>: <b><a href="../midas/surface.html">surf</a></b>
</blockquote>
Start <a href="../../ContributedSoftware/per-model/per-model.html"><b>Per-Model 
Clipping</b></a> (under <b>Tools... Depiction</b>). In that dialog, 
set <b>Model</b> to the surface (not <b>2gbp</b> itself,
which contains the atoms) and turn on <b>Enable clipping</b>.  
Now part of the surface but not the atoms should be chopped away.
The planar &ldquo;cap&rdquo; is not yet colored by B-factor; 
that will have to be done in a separate step. Keep the clipping dialog open.
</p><p>
Hide all atoms except for the ligand, glucose:
<blockquote>
<i>Command</i>: <b><a href="../midas/show.html">show</a> ligand</b>
</blockquote>
Next, adjust the clipping of the surface to the desired angle and position
relative to the structure.  In the
<a href="../../ContributedSoftware/per-model/per-model.html"><b>Per-Model 
Clipping</b></a> dialog, turn on <b>Adjust clipping with mouse as below</b>
and use the specified mouse buttons to translate and rotate
the clipping plane.  A transparent green disk will be shown while you are
making these adjustments.  The mouse button assignments can be changed
if you prefer.  To return the mouse buttons to their normal functions, 
turn off <b>Adjust clipping with mouse as below</b>.
It may be necessary to turn it on and off a few times to position the clipping
plane to your satisfaction.  Once that has been done, 
either turn off <b>Adjust clipping with mouse as below</b> or just
<b>Close</b> the clipping dialog to return the mouse buttons to their
normal functions.
</p><p>
The atoms were colored by <b>bfactor</b> value in the previous section.
Select protein atoms and use
<a href="../../ContributedSoftware/colorzone/colorzone.html"><b>Color 
Zone</b></a> to make the planar cap match these atoms:
<blockquote>
<i>Command</i>: <b><a href="../midas/select.html#newer">select</a> protein</b>
<br>
<i>Command</i>: <b><a href="../midas/start.html">start</a> Color Zone</b>
</blockquote>
This tool is also under <b>Tools... Depiction</b> in the menu.
It is important to select only the intended atoms so as to avoid coloring
the surface by other nearby atoms such as water and ions,
which may be undisplayed and easy to forget.
Click the <b>Color</b> button and increase the <b>Coloring radius</b>
as needed to to color the whole cap. A radius of ~3-4 &Aring; should suffice. 
Although the only part of the surface that needed coloring was the cap, 
<b>Color Zone</b> applies to the whole surface.
Whereas <b>Render by Attribute</b> (and most other per-atom coloring
of molecular surfaces) uses surface-to-atom associations
from the molecular surface calculation, <b>Color Zone</b> 
(which works on both nonmolecular and molecular surfaces) simply
associates a surface point with the closest atom center, and may thus
change the coloring slightly from the <b>Render by Attribute</b> result.
<!--
Feb 2014
ugly workaround 1: after finalizing cap position and mesh subdivision, 
 use scolor zone with autoUpdate false, reapply render or rangecolor
ugly workaround 2: two copies of per-model clipped surface, planes aligned,
 render or rangecolor one copy, thin slab & colorzone the other
-->
</p><p>
<b>Close</b> the <b>Color Zone</b> tool and clear the selection:
<blockquote>
<i>Command</i>: <b><a href="../midas/select.html#newer">~select</a></b>
</blockquote>
</p><p>
The color patches on the planar cap look somewhat fuzzy because of
coarse surface triangulation.  Start 
<a href="../../ContributedSoftware/surfcapper/surfcapper.html"><b>Surface
Capping</b></a>:
<blockquote>
<i>Command</i>: <b><a href="../midas/start.html">start</a> Surface Capping</b>
</blockquote>
and change the <b>Mesh subdivision factor</b> to <b>3</b> to make the
triangles smaller and the color patches on the cap more distinct.  
<b>Close</b> that tool.
</p>

<h3>Finishing Touches, Labels, Color Key</h3>
<p>
Use a publication preset to make the background white,
turn on black silhouettes, and generate a smoother molecular surface:
<blockquote>
<i>Command</i>: <b><a href="../midas/preset.html">preset</a> apply pub 1</b>
</blockquote>
This preset also turns off depth-cueing (fog).
</p><p>
Place and orient the structure for the final image,
leaving room for the title and color key.  If you want to, save the position:
<blockquote>
<i>Command</i>: <b><a href="../midas/savepos.html">savepos</a> p1</b>
</blockquote>
Then if you accidentally move the structure later, the position can be
restored with:
<blockquote>
<i>Command</i>: <b><a href="../midas/reset.html">reset</a> p1</b>
</blockquote>
If you decide a later position is better, you can save it to a new name,
or the same name to overwrite the previously saved position:
<blockquote>
<i>Command</i>: <b><a href="../midas/savepos.html">savepos</a> p1</b>
</blockquote>
Open the
<a href="../../ContributedSoftware/2dlabels/2dlabels.html#colorkey"><b>Color
Key</b></a> dialog (under <b>Tools... Utilities</b>).  In that dialog,
set the <b>Label color</b> to <b>black</b>
by clicking the <a href="../coloring.html#colorwell">color well</a>
and using the <a href="../colortool.html"><b>Color Editor</b></a>.
The appropriate <b>Font size</b> depends on the window size;
<b>26</b> was used with a 573 x 443 window.
</p><p>
Make sure that <b>Use mouse for key placement</b> is turned on and then
click-drag in the main window to draw the key.  It may take a few tries;
click-drag to start over, or click on the middle of the key
to drag it around.  To rotate the structure instead (and/or to prevent 
erasing the existing color key), turn off <b>Use mouse for key 
placement</b>.  After drawing the key to your satisfaction: 
<ul>
<li>set <b>Numeric label separation</b> to <b>equal</b> in order to space
the value labels 2, 30, and 50 evenly rather than based on their values
<li>change <b>Border color</b> to <b>black</b> 
<li>adjust <b>Border width</b> to <b>2</b>
</ul>
To add additional text to the image, click the tab to go to the <b>Labels</b>
(<a href="../../ContributedSoftware/2dlabels/2dlabels.html"><b>2D 
Labels</b></a>)
section of the same dialog.  Set the <b>Color</b> to <b>black</b>, then
click in the graphics window to start a label and type to enter its contents.  
Each label can be repositioned by dragging
and its font size can be edited to a different value.
What font sizes are appropriate depends on the window size; 
use what you think looks best.  The <a href="2gbp-bfactor.png">example image</a>
was created using window size 573 x 443, font size 30 for the 
main title, and font size 28 for the text above the color key.
The &Aring; symbol and superscript &sup2; can be included by using
the <b>Insert symbol</b> menu.  Alternatively, symbols can be copied 
from text displays (such as a 
<a href="../../ContributedSoftware/2dlabels/symbols.html">symbols page</a>
or even the preceding sentence!) and pasted into the <b>Text</b> area of the
<a href="../../ContributedSoftware/2dlabels/2dlabels.html"><b>2D Labels</b></a>
dialog.  <b>Close</b> the dialog as soon as the labels are done, to allow 
rotating the structure and to avoid accidentally creating more labels.
</p>

<h3>Saving Your Work</h3>
<p>
<a href="../sessions.html#savesess">Saving a session</a>
(see the <b>File</b> menu) right before or after saving the image
is recommended if you might need to regenerate the same or a similar figure 
later, say at a different resolution or with modified coloring.
</p><p>
The <a href="2gbp-bfactor.png">image</a> was saved at the same size as 
the window (573 x 443 pixels) 
using <b>File... Save Image</b> with default settings.
</p>

<hr>
<address>meng-at-cgl.ucsf.edu / February 2014</address>
</body>
</html>
